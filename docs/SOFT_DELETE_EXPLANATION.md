# üóëÔ∏è –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚úÖ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ú–Ø–ì–ö–û–ï –£–î–ê–õ–ï–ù–ò–ï

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (soft delete)** - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è production-—Å–∏—Å—Ç–µ–º.

## üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ö–æ–¥ –≤ `server/src/services/users.service.ts`:

```typescript
// –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è)
async deleteUser(id: number) {
  return await this.deactivateUser(id);
}

// –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async deactivateUser(id: number) {
  return await prisma.user.update({
    where: { id },
    data: { isActive: false },  // ‚Üê –ü—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º —Ñ–ª–∞–≥!
    select: { id: true, isActive: true },
  });
}
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ "—É–¥–∞–ª–µ–Ω–∏–∏":

1. ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–ù–ï —É–¥–∞–ª—è–µ—Ç—Å—è** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`
2. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ `isActive: false`
3. ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î
4. ‚úÖ –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–ø—Ä–æ–¥–∞–∂–∏, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ç.–¥.) –æ—Å—Ç–∞—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º–∏

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

### 1. –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª 100 –ø—Ä–æ–¥–∞–∂ ‚Üí "–£–¥–∞–ª–∏–ª–∏" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ –ü—Ä–æ–¥–∞–∂–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Å –≤–∞–ª–∏–¥–Ω—ã–º user_id
‚úÖ –ú–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é: –∫—Ç–æ —Å–æ–∑–¥–∞–ª –ø—Ä–æ–¥–∞–∂—É
```

### 2. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```sql
-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
UPDATE users SET is_active = true WHERE id = 5;
```

### 3. –ê—É–¥–∏—Ç –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ú–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è "—É–¥–∞–ª–µ–Ω–Ω—ã—Ö" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ö—Ä–∞–Ω–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ù–µ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö —É–¥–∞–ª–µ–Ω–∏–π
- Foreign key constraints –Ω–µ –Ω–∞—Ä—É—à–∞—é—Ç—Å—è
- –ù–µ—Ç cascade deletions

## üìä –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
SELECT id, email, is_active FROM users;

-- –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (—Ç–µ —á—Ç–æ –≤–∏–¥–Ω—ã –≤ UI)
SELECT id, email FROM users WHERE is_active = true;

-- –¢–æ–ª—å–∫–æ "—É–¥–∞–ª–µ–Ω–Ω—ã–µ"
SELECT id, email FROM users WHERE is_active = false;
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```
ID  Email                  is_active  –°—Ç–∞—Ç—É—Å
1   admin@dfupr.com        true       ‚úÖ –í–∏–¥–µ–Ω –≤ UI
2   manager@dfupr.com      true       ‚úÖ –í–∏–¥–µ–Ω –≤ UI
4   it@dkdk.com            false      ‚ùå "–£–¥–∞–ª–µ–Ω" (—Å–∫—Ä—ã—Ç)
7   usu@dus.com            false      ‚ùå "–£–¥–∞–ª–µ–Ω" (—Å–∫—Ä—ã—Ç)
8   ttt@ttt.com            false      ‚ùå "–£–¥–∞–ª–µ–Ω" (—Å–∫—Ä—ã—Ç)
```

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ñ–µ—Å—Ç–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ **—Ä–µ–∞–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å** –∏–∑ –ë–î:

```typescript
async hardDeleteUser(id: number) {
  return await prisma.user.delete({
    where: { id }
  });
}
```

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∂–µ—Å—Ç–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:

1. ‚ùå –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
2. ‚ùå Broken foreign keys
3. ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞
4. ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
5. ‚ùå Cascade delete –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–û—Å—Ç–∞–≤–∏—Ç—å –º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ!** –≠—Ç–æ:
- ‚úÖ Best practice –¥–ª—è production
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º GDPR/–∞—É–¥–∏—Ç–∞
- ‚úÖ –ù–µ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é –¥–∞–Ω–Ω—ã—Ö

## üõ†Ô∏è –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é **–æ—á–∏—Å—Ç–∫–∏** —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π (cron job):

```typescript
// –£–¥–∞–ª–∏—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞
async cleanupInactiveUsers() {
  const oneYearAgo = new Date();
  oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
  
  return await prisma.user.deleteMany({
    where: {
      isActive: false,
      updatedAt: { lt: oneYearAgo }
    }
  });
}
```

---

**–ò—Ç–æ–≥**: –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** ‚úÖ  
**–î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î**, –Ω–æ —Å–∫—Ä—ã—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
