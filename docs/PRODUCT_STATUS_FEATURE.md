# Управление статусом номенклатуры

## Описание изменений

Добавлена возможность управления статусом номенклатуры (активен/неактивен) непосредственно в карточке товара.

## Что было сделано

### 1. Frontend (Клиент)

#### Компоненты UI
- **Создан новый компонент Switch** (`client/src/components/ui/switch.tsx`)
  - Современный переключатель на основе Radix UI
  - Зеленый цвет для активного состояния
  - Серый цвет для неактивного состояния

#### Форма номенклатуры
- **Обновлен файл** `client/src/components/forms/ProductForm.tsx`
  - Добавлено поле `isActive` в схему валидации
  - Добавлено поле `isActive` в defaultValues формы
  - Добавлен переключатель статуса в UI формы
  - Переключатель отображается в разделе "Основная информация" с понятной подписью

#### Типы
- **Обновлен файл** `client/src/types/nomenclature.ts`
  - Добавлено поле `isActive?: boolean` в интерфейс `CreateProductData`
  - Поле уже было в интерфейсе `UpdateProductData`

### 2. Backend (Сервер)

#### Валидация
- **Обновлен файл** `server/src/validation/product.validation.ts`
  - Добавлено поле `isActive` в схему `productCreateSchema` с значением по умолчанию `true`
  - Поле уже существовало в схеме `productUpdateSchema`

#### Сервисы
- **Обновлен файл** `server/src/services/product.service.ts`
  - Добавлено поле `isActive?: boolean` в интерфейс `ProductCreateInput`
  - Поле уже было в интерфейсе `ProductUpdateInput`

### 3. Зависимости
- Установлен пакет `@radix-ui/react-switch` для компонента Switch

## Использование

### Для пользователей

1. **Создание нового товара:**
   - При создании нового товара статус по умолчанию установлен в "Активен"
   - Можно изменить статус, переключив switch в форме создания

2. **Редактирование товара:**
   - Откройте форму редактирования товара
   - В разделе "Основная информация" найдите переключатель статуса
   - Переключите его для изменения статуса на "Активен" или "Неактивен"
   - Сохраните изменения

3. **Визуальная индикация:**
   - Зеленый переключатель = товар активен
   - Серый переключатель = товар неактивен
   - Подпись рядом с переключателем показывает текущий статус

### Для разработчиков

**Пример использования в других формах:**

```tsx
import { Switch } from '@/components/ui/switch';
import { Controller } from 'react-hook-form';

// В компоненте формы:
<Controller
  name="isActive"
  control={control}
  render={({ field }) => (
    <>
      <Switch
        id="isActive"
        checked={field.value}
        onCheckedChange={field.onChange}
      />
      <Label htmlFor="isActive" className="cursor-pointer">
        {field.value ? 'Статус: Активен' : 'Статус: Неактивен'}
      </Label>
    </>
  )}
/>
```

## Технические детали

### Схема базы данных
Поле `is_active` уже существовало в таблице `products`:
```sql
is_active BOOLEAN NOT NULL DEFAULT true
```

### API эндпоинты

**POST /api/products** - Создание товара
```json
{
  "name": "Мука пшеничная",
  "unitId": 1,
  "isActive": true
}
```

**PUT /api/products/:id** - Обновление товара
```json
{
  "isActive": false
}
```

## Связанные файлы

### Frontend
- `client/src/components/ui/switch.tsx` - новый компонент
- `client/src/components/forms/ProductForm.tsx` - обновлен
- `client/src/types/nomenclature.ts` - обновлен

### Backend
- `server/src/validation/product.validation.ts` - обновлен
- `server/src/services/product.service.ts` - обновлен

## Будущие улучшения

1. Добавить фильтр по статусу в списке номенклатуры
2. Добавить индикатор статуса в таблице товаров
3. Добавить массовое изменение статуса для нескольких товаров
4. Добавить историю изменений статуса в аудит

## Исправление фильтрации (4 октября 2025)

### Проблема
После деактивации товара он исчезал из списка, так как был установлен фильтр по умолчанию `isActive: true`.

### Решение
1. **Frontend** (`client/src/pages/Products/ProductsListPage.tsx`)
   - Убран фильтр по умолчанию `isActive: true`
   - Добавлена опция "Все товары" в выпадающий список фильтра статусов
   - Теперь по умолчанию показываются все товары (активные и неактивные)
   - Пользователь может выбрать: "Все товары", "Только активные" или "Только неактивные"

2. **Backend** (`server/src/services/product.service.ts`)
   - Убрано значение по умолчанию `isActive = true` в методе `getProducts`
   - Изменена логика фильтрации: фильтр по `isActive` применяется только если он явно передан
   - Если `isActive` не передан (undefined), возвращаются все товары

### Результат
- Теперь при деактивации товара он остается в списке
- Статус товара визуально отображается бейджем (зеленый "Активен" или красный "Неактивен")
- Пользователь может фильтровать товары по статусу через выпадающий список в разделе фильтров

## Дата внедрения
4 октября 2025

